# ジェスチャーウルフ - 要求仕様書

## 1. 機能要求 (Functional Requirements)

### 1.1 ユーザー管理機能

#### FR-1.1.1 プレイヤー数設定
- **ID**: FR-1.1.1
- **優先度**: 必須
- **説明**: プレイヤー数を3〜8人の範囲で選択できる
- **受入基準**:
  - プレイヤー数を3〜8人で選択可能
  - 範囲外の値は選択不可
  - デフォルト値は4人

#### FR-1.1.2 プレイヤー名設定
- **ID**: FR-1.1.2
- **優先度**: 必須
- **説明**: 各プレイヤーの名前を設定できる
- **受入基準**:
  - 各プレイヤーに名前を入力可能
  - 未入力時はデフォルト名（プレイヤー1, 2...）を使用
  - 最大文字数は20文字
  - 特殊文字、絵文字も使用可能

#### FR-1.1.3 ウルフ人数自動計算
- **ID**: FR-1.1.3
- **優先度**: 必須
- **説明**: プレイヤー数に応じてウルフ人数を自動計算
- **受入基準**:
  - 3-4人: ウルフ1人
  - 5-6人: ウルフ1人
  - 7-8人: ウルフ1-2人（設定可能）
  - ウルフ人数が画面に表示される

---

### 1.2 お題管理機能

#### FR-1.2.1 カテゴリー別お題選択
- **ID**: FR-1.2.1
- **優先度**: 必須
- **説明**: カテゴリーからお題を選択できる
- **受入基準**:
  - 動物、スポーツ、職業、動作の4カテゴリー以上
  - 各カテゴリーに5組以上のお題ペア
  - お題ペアをリストで表示
  - 選択したお題がハイライト表示

#### FR-1.2.2 ランダムお題選択
- **ID**: FR-1.2.2
- **優先度**: 必須
- **説明**: お題をランダムに選択できる
- **受入基準**:
  - ボタン一つでランダムにお題を選択
  - 全カテゴリーから均等に選択
  - 選択されたお題とカテゴリーを表示

#### FR-1.2.3 カスタムお題入力
- **ID**: FR-1.2.3
- **優先度**: 推奨
- **説明**: ユーザーが独自のお題を入力できる
- **受入基準**:
  - 市民のお題を入力可能
  - ウルフのお題を入力可能
  - 各お題の最大文字数は30文字
  - 入力したお題でゲーム開始可能

#### FR-1.2.4 カスタムお題保存
- **ID**: FR-1.2.4
- **優先度**: オプション
- **説明**: カスタムお題をローカルに保存
- **受入基準**:
  - カスタムお題を保存できる
  - 保存したお題をリストで表示
  - 保存したお題を削除可能
  - 最大保存数は50組

---

### 1.3 お題配布機能

#### FR-1.3.1 個別お題表示
- **ID**: FR-1.3.1
- **優先度**: 必須
- **説明**: 各プレイヤーに個別にお題を表示
- **受入基準**:
  - プレイヤー名を表示
  - 「お題を見る」ボタンでお題を表示
  - お題は大きく見やすい文字で表示
  - 「確認しました」ボタンで次へ進む

#### FR-1.3.2 お題の秘匿性確保
- **ID**: FR-1.3.2
- **優先度**: 必須
- **説明**: 他のプレイヤーにお題が見られないようにする
- **受入基準**:
  - お題を見る前に注意メッセージを表示
  - お題表示中は画面が覆われる
  - 確認ボタンを押すまで次に進めない

#### FR-1.3.3 ウルフのランダム選出
- **ID**: FR-1.3.3
- **優先度**: 必須
- **説明**: ウルフをランダムに選出
- **受入基準**:
  - 設定されたウルフ人数分をランダムに選出
  - 選出の偏りがない（均等な確率）
  - 選出結果は結果画面まで秘匿

---

### 1.4 ジェスチャータイム機能

#### FR-1.4.1 タイマー機能
- **ID**: FR-1.4.1
- **優先度**: 必須
- **説明**: 各プレイヤーのジェスチャー時間を計測
- **受入基準**:
  - カウントダウンタイマーを表示
  - デフォルト時間は15秒
  - 設定で10-30秒に変更可能
  - 残り5秒で視覚的な警告（色変化など）

#### FR-1.4.2 プレイヤー進行管理
- **ID**: FR-1.4.2
- **優先度**: 必須
- **説明**: プレイヤーの進行を管理
- **受入基準**:
  - 現在のプレイヤー名を表示
  - 進行状況を表示（〇/〇人）
  - 「次のプレイヤー」ボタンで次へ進む
  - タイマー終了時も次へ進める

#### FR-1.4.3 2周目実施機能
- **ID**: FR-1.4.3
- **優先度**: 推奨
- **説明**: ジェスチャーを2周実施できる
- **受入基準**:
  - 1周目終了後に2周目の選択肢を表示
  - 2周目を選択した場合、再度全員がジェスチャー
  - 2周目はスキップ可能

#### FR-1.4.4 スキップ機能
- **ID**: FR-1.4.4
- **優先度**: オプション
- **説明**: ジェスチャーをスキップできる
- **受入基準**:
  - スキップボタンを表示
  - タップで即座に次のプレイヤーへ
  - スキップの確認ダイアログ表示

---

### 1.5 ディスカッション機能

#### FR-1.5.1 ディスカッションタイマー
- **ID**: FR-1.5.1
- **優先度**: 必須
- **説明**: ディスカッション時間を計測
- **受入基準**:
  - カウントダウンタイマーを表示
  - デフォルト時間は3分
  - 設定で1-5分に変更可能
  - タイマー終了時に通知

#### FR-1.5.2 ルール表示
- **ID**: FR-1.5.2
- **優先度**: 推奨
- **説明**: ディスカッションのルールを表示
- **受入基準**:
  - ルールをテキストで表示
  - 「ジェスチャー追加はNG」などの注意事項
  - プレイヤーリストを参考表示

#### FR-1.5.3 タイマー延長機能
- **ID**: FR-1.5.3
- **優先度**: オプション
- **説明**: ディスカッション時間を延長できる
- **受入基準**:
  - 延長ボタンを表示
  - タップで1分延長
  - 最大3回まで延長可能

---

### 1.6 投票機能

#### FR-1.6.1 投票実施
- **ID**: FR-1.6.1
- **優先度**: 必須
- **説明**: 各プレイヤーが投票を行う
- **受入基準**:
  - 全プレイヤーをボタンで表示
  - 自分以外のプレイヤーに投票可能
  - 投票確定ボタンで確定
  - 投票状況を表示（〇/〇人投票済み）

#### FR-1.6.2 投票集計
- **ID**: FR-1.6.2
- **優先度**: 必須
- **説明**: 投票結果を集計
- **受入基準**:
  - 全員の投票を集計
  - 最多票のプレイヤーを判定
  - 同票の場合の処理（全員表示または再投票）

#### FR-1.6.3 投票やり直し
- **ID**: FR-1.6.3
- **優先度**: 推奨
- **説明**: 投票をやり直せる
- **受入基準**:
  - 確定前ならやり直し可能
  - やり直しボタンを表示
  - 選択をクリア

---

### 1.7 結果表示機能

#### FR-1.7.1 勝敗判定
- **ID**: FR-1.7.1
- **優先度**: 必須
- **説明**: ゲームの勝敗を判定
- **受入基準**:
  - ウルフが当てられたか判定
  - 勝利チーム（市民/ウルフ）を表示
  - 大きく見やすいアニメーション

#### FR-1.7.2 ウルフ公開
- **ID**: FR-1.7.2
- **優先度**: 必須
- **説明**: ウルフが誰だったか公開
- **受入基準**:
  - ウルフのプレイヤー名を表示
  - ウルフが複数の場合は全員表示
  - 視覚的に分かりやすく表示

#### FR-1.7.3 お題公開
- **ID**: FR-1.7.3
- **優先度**: 必須
- **説明**: 全プレイヤーのお題を公開
- **受入基準**:
  - 全プレイヤーのリストを表示
  - 各プレイヤーのお題を表示
  - 市民/ウルフの区別を表示

#### FR-1.7.4 投票結果表示
- **ID**: FR-1.7.4
- **優先度**: 推奨
- **説明**: 投票結果のサマリーを表示
- **受入基準**:
  - 各プレイヤーの得票数を表示
  - グラフまたはリストで表示
  - 誰が誰に投票したかを表示（オプション）

---

### 1.8 ナビゲーション機能

#### FR-1.8.1 ゲーム再開
- **ID**: FR-1.8.1
- **優先度**: 必須
- **説明**: 結果画面からゲームを再開できる
- **受入基準**:
  - 「もう一度遊ぶ」ボタンを表示
  - タップでプレイヤー設定画面へ
  - 前回の設定を保持（オプション）

#### FR-1.8.2 ホーム画面へ戻る
- **ID**: FR-1.8.2
- **優先度**: 必須
- **説明**: ホーム画面に戻れる
- **受入基準**:
  - 「ホームに戻る」ボタンを表示
  - タップでホーム画面へ
  - 現在のゲーム状態をクリア

#### FR-1.8.3 戻るボタン
- **ID**: FR-1.8.3
- **優先度**: 必須
- **説明**: 各画面で前の画面に戻れる
- **受入基準**:
  - 戻るボタンを表示（該当画面のみ）
  - Android バックボタンに対応
  - ゲーム中は確認ダイアログを表示

---

### 1.9 設定機能

#### FR-1.9.1 時間設定
- **ID**: FR-1.9.1
- **優先度**: 必須
- **説明**: タイマー時間を設定できる
- **受入基準**:
  - ジェスチャー時間: 10-30秒
  - ディスカッション時間: 1-5分
  - スライダーまたはドロップダウンで選択
  - デフォルト値を表示

#### FR-1.9.2 音声設定
- **ID**: FR-1.9.2
- **優先度**: 推奨
- **説明**: 効果音とBGMを設定できる
- **受入基準**:
  - 効果音ON/OFFスイッチ
  - BGM ON/OFFスイッチ
  - 音量調整（オプション）

#### FR-1.9.3 テーマ設定
- **ID**: FR-1.9.3
- **優先度**: 推奨
- **説明**: ダークモードを設定できる
- **受入基準**:
  - ダークモードON/OFFスイッチ
  - システム設定に従う（オプション）
  - リアルタイムで反映

#### FR-1.9.4 言語設定
- **ID**: FR-1.9.4
- **優先度**: オプション
- **説明**: アプリの言語を変更できる
- **受入基準**:
  - 日本語/英語を選択可能
  - UI全体が切り替わる
  - お題データも多言語対応

---

### 1.10 ルール説明機能

#### FR-1.10.1 ルール表示
- **ID**: FR-1.10.1
- **優先度**: 必須
- **説明**: ゲームのルールを表示
- **受入基準**:
  - ゲーム概要を表示
  - 基本ルールを表示
  - 遊び方の流れを表示
  - 勝利条件を表示

#### FR-1.10.2 チュートリアル
- **ID**: FR-1.10.2
- **優先度**: オプション
- **説明**: 初回起動時にチュートリアルを表示
- **受入基準**:
  - 初回起動時に自動表示
  - スキップ可能
  - 設定から再表示可能

---

### 1.11 データ永続化機能

#### FR-1.11.1 設定保存
- **ID**: FR-1.11.1
- **優先度**: 必須
- **説明**: ユーザー設定を保存
- **受入基準**:
  - アプリ終了時に設定を保存
  - 起動時に設定を復元
  - デフォルト値にリセット可能

#### FR-1.11.2 プレイ履歴保存
- **ID**: FR-1.11.2
- **優先度**: オプション
- **説明**: ゲームの履歴を保存
- **受入基準**:
  - 最新10ゲームの履歴を保存
  - 日時、プレイヤー、勝敗を記録
  - 履歴を表示可能
  - 履歴を削除可能

#### FR-1.11.3 お気に入りお題
- **ID**: FR-1.11.3
- **優先度**: オプション
- **説明**: お気に入りのお題を保存
- **受入基準**:
  - お題にお気に入りボタンを表示
  - タップでお気に入りに追加/削除
  - お気に入りリストを表示
  - 最大30組まで保存

---

## 2. 非機能要求 (Non-Functional Requirements)

### 2.1 パフォーマンス要求

#### NFR-2.1.1 起動時間
- **ID**: NFR-2.1.1
- **優先度**: 必須
- **説明**: アプリの起動時間
- **基準**: コールドスタート3秒以内、ウォームスタート1秒以内

#### NFR-2.1.2 画面遷移
- **ID**: NFR-2.1.2
- **優先度**: 必須
- **説明**: 画面遷移の速度
- **基準**: 画面遷移は500ms以内に完了

#### NFR-2.1.3 タイマー精度
- **ID**: NFR-2.1.3
- **優先度**: 必須
- **説明**: タイマーの精度
- **基準**: 誤差は±100ms以内

#### NFR-2.1.4 メモリ使用量
- **ID**: NFR-2.1.4
- **優先度**: 推奨
- **説明**: メモリ使用量
- **基準**: 100MB以下（通常動作時）

---

### 2.2 ユーザビリティ要求

#### NFR-2.2.1 直感的なUI
- **ID**: NFR-2.2.1
- **優先度**: 必須
- **説明**: 初見でも操作できるUI
- **基準**: 
  - ルール説明を読めば操作できる
  - ボタンの機能が明確
  - 一貫したデザイン言語

#### NFR-2.2.2 視認性
- **ID**: NFR-2.2.2
- **優先度**: 必須
- **説明**: 見やすい画面デザイン
- **基準**:
  - WCAG 2.1 AA準拠のコントラスト比
  - 最小フォントサイズ14pt
  - 暗い場所でも見やすい配色

#### NFR-2.2.3 操作性
- **ID**: NFR-2.2.3
- **優先度**: 必須
- **説明**: タップしやすいUI
- **基準**:
  - タップ可能領域は最小44x44pt
  - ボタン間の余白は十分に確保
  - 誤タップ防止の確認ダイアログ

#### NFR-2.2.4 フィードバック
- **ID**: NFR-2.2.4
- **優先度**: 推奨
- **説明**: 操作に対するフィードバック
- **基準**:
  - タップ時の視覚的フィードバック
  - 重要な操作は効果音
  - ローディング時はインジケーター表示

---

### 2.3 互換性要求

#### NFR-2.3.1 Android対応
- **ID**: NFR-2.3.1
- **優先度**: 必須
- **説明**: Android端末での動作
- **基準**: Android 6.0 (API 23) 以上

#### NFR-2.3.2 iOS対応
- **ID**: NFR-2.3.2
- **優先度**: 必須
- **説明**: iOS端末での動作
- **基準**: iOS 12.0以上

#### NFR-2.3.3 画面サイズ対応
- **ID**: NFR-2.3.3
- **優先度**: 必須
- **説明**: 様々な画面サイズに対応
- **基準**:
  - スマートフォン: 4.7〜6.7インチ
  - タブレット: 7〜12インチ（推奨）
  - レスポンシブレイアウト

#### NFR-2.3.4 画面向き
- **ID**: NFR-2.3.4
- **優先度**: 推奨
- **説明**: 画面向きの対応
- **基準**: 縦画面固定（横画面はオプション）

---

### 2.4 可用性要求

#### NFR-2.4.1 オフライン動作
- **ID**: NFR-2.4.1
- **優先度**: 必須
- **説明**: インターネット接続不要
- **基準**: 全機能がオフラインで動作

#### NFR-2.4.2 エラーハンドリング
- **ID**: NFR-2.4.2
- **優先度**: 必須
- **説明**: エラー時の適切な処理
- **基準**:
  - クラッシュしない
  - エラーメッセージを表示
  - 復旧可能な状態を維持

#### NFR-2.4.3 データ整合性
- **ID**: NFR-2.4.3
- **優先度**: 必須
- **説明**: データの整合性を保つ
- **基準**:
  - ゲーム状態の正確な管理
  - 保存データの破損防止
  - バリデーション実施

---

### 2.5 保守性要求

#### NFR-2.5.1 コード品質
- **ID**: NFR-2.5.1
- **優先度**: 必須
- **説明**: 保守しやすいコード
- **基準**:
  - Flutter/Dart ベストプラクティス準拠
  - Linter警告ゼロ
  - コメント適切に記載

#### NFR-2.5.2 テストカバレッジ
- **ID**: NFR-2.5.2
- **優先度**: 推奨
- **説明**: テストコードの充実
- **基準**:
  - 単体テストカバレッジ60%以上
  - 主要機能の統合テスト実施

#### NFR-2.5.3 ドキュメント
- **ID**: NFR-2.5.3
- **優先度**: 必須
- **説明**: 適切なドキュメント
- **基準**:
  - README完備
  - API/クラス設計ドキュメント
  - セットアップ手順

---

### 2.6 セキュリティ要求

#### NFR-2.6.1 データ保護
- **ID**: NFR-2.6.1
- **優先度**: 必須
- **説明**: ローカルデータの保護
- **基準**:
  - 個人情報は保存しない
  - ローカルストレージの適切な使用

#### NFR-2.6.2 権限
- **ID**: NFR-2.6.2
- **優先度**: 必須
- **説明**: 不要な権限を要求しない
- **基準**:
  - 最小限の権限のみ要求
  - 権限の用途を明示

---

### 2.7 スケーラビリティ要求

#### NFR-2.7.1 お題データ拡張
- **ID**: NFR-2.7.1
- **優先度**: 推奨
- **説明**: お題データを容易に追加できる
- **基準**:
  - JSONまたはDartファイルで管理
  - 追加が容易な構造
  - 100組以上のお題に対応

#### NFR-2.7.2 機能拡張性
- **ID**: NFR-2.7.2
- **優先度**: 推奨
- **説明**: 将来の機能追加に対応
- **基準**:
  - モジュール化された設計
  - プラグインアーキテクチャ（検討）

---

## 3. 制約条件 (Constraints)

### 3.1 技術制約

#### C-3.1.1 開発環境
- Flutter 3.x以上
- Dart 3.x以上
- Android Studio または VS Code

#### C-3.1.2 依存パッケージ
- 最新の安定版を使用
- メンテナンスされているパッケージのみ

#### C-3.1.3 プラットフォーム
- Android、iOSのみ（Web/Desktop は対象外）

---

### 3.2 ビジネス制約

#### C-3.2.1 コスト
- 無料で提供
- 広告なし
- アプリ内課金なし

#### C-3.2.2 開発期間
- Phase 1-2: 4週間
- Phase 3-4: 2週間
- 合計6週間を目標

---

### 3.3 法的制約

#### C-3.3.1 ライセンス
- MITライセンスまたは同等のOSS
- 商用利用可能なアセット

#### C-3.3.2 プライバシー
- 個人情報の収集なし
- プライバシーポリシー作成（リリース時）

---

## 4. 前提条件 (Assumptions)

### A-4.1 ユーザー環境
- スマートフォンまたはタブレットを所持
- 基本的な操作ができる
- 3人以上が集まってプレイ

### A-4.2 使用状況
- パーティーやイベントでの使用
- 対面でのプレイ
- 1ゲーム10-15分程度

---

## 5. 依存関係 (Dependencies)

### D-5.1 外部依存
- なし（完全オフライン動作）

### D-5.2 内部依存
- お題データファイル
- アセット（画像、音声など）

---

## 6. 受入基準 (Acceptance Criteria)

### 6.1 機能面
- [ ] 全必須機能が実装されている
- [ ] 3-8人でゲームが正常に進行する
- [ ] ウルフの選出が適切に機能する
- [ ] タイマーが正確に動作する
- [ ] 投票と結果表示が正常に機能する

### 6.2 品質面
- [ ] クラッシュなく動作する
- [ ] 主要機能のテストが通過する
- [ ] UIが直感的で使いやすい
- [ ] パフォーマンス要求を満たす

### 6.3 互換性面
- [ ] Android端末で正常動作
- [ ] iOS端末で正常動作
- [ ] 様々な画面サイズに対応

---

## 7. 優先度マトリクス

| 機能カテゴリー | 必須 | 推奨 | オプション |
|--------------|-----|-----|-----------|
| ユーザー管理 | 3 | 0 | 1 |
| お題管理 | 2 | 1 | 1 |
| お題配布 | 3 | 0 | 0 |
| ジェスチャータイム | 2 | 1 | 1 |
| ディスカッション | 1 | 1 | 1 |
| 投票 | 2 | 1 | 0 |
| 結果表示 | 3 | 1 | 0 |
| ナビゲーション | 3 | 0 | 0 |
| 設定 | 1 | 2 | 1 |
| ルール説明 | 1 | 0 | 1 |
| データ永続化 | 1 | 0 | 2 |

---

## 8. リスクと対策

### 8.1 技術リスク

#### R-8.1.1 状態管理の複雑化
- **リスク**: ゲーム状態が複雑化し、バグが発生
- **対策**: Riverpod/Providerを適切に使用、テスト充実

#### R-8.1.2 タイマーの不正確さ
- **リスク**: バックグラウンド時にタイマーが止まる
- **対策**: ライフサイクル管理を適切に実装

#### R-8.1.3 画面サイズ対応
- **リスク**: 一部端末でレイアウト崩れ
- **対策**: レスポンシブデザイン、実機テスト

### 8.2 ユーザビリティリスク

#### R-8.2.1 ルールが分かりにくい
- **リスク**: 初めてのユーザーが遊べない
- **対策**: 丁寧なルール説明、チュートリアル

#### R-8.2.2 お題の秘匿性
- **リスク**: 他の人にお題が見られる
- **対策**: 注意メッセージ、画面デザイン工夫

### 8.3 スケジュールリスク

#### R-8.3.1 開発遅延
- **リスク**: 予定より開発に時間がかかる
- **対策**: MVP（必須機能のみ）を優先、段階的リリース

---

## 変更履歴

| 日付 | バージョン | 変更内容 | 担当者 |
|------|-----------|---------|-------|
| 2025-12-06 | 1.0.0 | 初版作成 | - |
